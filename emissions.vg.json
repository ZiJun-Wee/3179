{
    "$schema" : "https://vega.github.io/schema/vega-lite/v5.json",
    "params": [
        {
            "name": "year_Filter",
            "value": 2019,
            "bind":{
                "input": "range",
                "min": 2000,
                "step": 1,
                "name": "Year: "
            }
        }
    ],
    "hconcat": [
        {
            "width": "container",
            "data": {
                "url": "https://raw.githubusercontent.com/ZiJun-Wee/3179/Assignment-2/ne_110m.topojson",
                "format": {"type": "topojson", "feature": "ne_110m_admin_0_countries"}
            },
            "transform": [
                {
                    "lookup": "properties.NAME",
                    "from": {
                        "data": {
                            "url": "https://raw.githubusercontent.com/ZiJun-Wee/3179/Assignment-2/world-data-2023.csv"
                        },
                        "key": "Country",
                        "fields": ["Co2Emissions", "Population"]
                    }
                },
                {"calculate": "datum.Co2Emissions/datum.Population *10000", "as": "CO2 Emission(kT) per 10,000 Capita"}
            ],
            "mark": {"type": "geoshape"},
            "encoding": {
                "color": {
                    "field": "CO2 Emission(kT) per 10,000 Capita",
                    "type": "quantitative",
                    "scale": {
                        "type": "threshold",
                        "domain": [1, 10, 25, 50, 100],
                        "range": [
                            "#ffcbd1",
                            "#ee6b6e",
                            "#ff2c2c",
                            "#de0a26",
                            "#c30010"
                        ]
                    }
                },
                "tooltip": [
                    {"field": "properties.NAME", "type": "nominal", "title": "Country"},
                    {"field": "CO2 Emission(kT) per 10,000 Capita", "type": "quantitative"}
                    ]
            }
        },
        {
            "width":"container",
            "data": {"url": "https://raw.githubusercontent.com/ZiJun-Wee/3179/Assignment-2/global-data-on-sustainable-energy.csv"},
            "transform": [
                {"filter": "datum.Value_co2_emissions_kt_by_country > 0"},
                {"filter": "datum.gdp_per_capita >0"},
                {"filter": "datum.Year == year_Filter"},
                {"calculate": "if(datum.gdp_per_capita < 1135, 'low income', if(datum.gdp_per_capita < 4465, 'lower-middle income', if(datum.gdp_per_capita <13845, 'upper-middle income', 'high income')))", "as": "GDP level" }
            ],
            "params": [
                {
                    "name": "incomeHighlight",
                    "select": {"type": "point", "fields": ["GDP level"]},
                    "bind":"legend"
                },
                {
                    "name": "grid",
                    "select":"interval",
                    "bind":"scales"
                }
            ],
            "mark": {"type": "circle" },
            "encoding": {
                "y" :{
                    "field":"Electricity from fossil fuels (TWh)", 
                    "type": "quantitative",
                    "axis": {"grid": false}
                },
                "x": {
                    "field":"Value_co2_emissions_kt_by_country", 
                    "type": "quantitative",
                    "scale": {"type": "log"},
                    "axis": {"grid": false}
                    
                },
                "color": {
                    "field": "GDP level", 
                    "type": "nominal",
                    "sort": ["low income", "lower-middle income", "upper-middle income", "high income"]
                },
                "size": {
                    "field": "gdp_per_capita", 
                    "type": "quantitative"   
                },
                "opacity":{
                    "condition": {"param": "incomeHighlight", "value": 0.6},
                    "value": 0.2
                },
                "tooltip":[
                    {"field": "Country", "type": "nominal"},
                    {"field": "Value_co2_emissions_kt_by_country", "type": "quantitative", "title": "CO2 emissions kT by country", "format": ","},
                    {"field": "Electricity from fossil fuels (TWh)", "type": "quantitative", "format": ","},
                    {"field": "gdp_per_capita", "type": "quantitative", "format": ",", "title": "GDP per capita"}
                ]
            }    
        }   
    ]        
}